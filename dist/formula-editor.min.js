!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.formulaEditor=t():e.formulaEditor=t()}(self,(()=>(()=>{"use strict";var e={614:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(81),s=n.n(i),r=n(645),o=n.n(r)()(s());o.push([e.id,":root {\n  --me-theme: #bcd4e7;\n  --me-theme-light: #d0e3f2;\n  --me-hover: #f1f2f4;\n  --me-border: #ddd;\n  --me-gray: ##666;\n}\n.math-editor {\n  color: #000;\n  font-size: 18px;\n  text-align: left;\n  border: 1px solid #ccc;\n  overflow: hidden;\n}\n.math-editor * {\n  margin: 0;\n  padding: 0;\n}\n.math-editor div {\n  box-sizing: border-box;\n}\n.math-editor .me-menu {\n  width: 100%;\n  padding: 0 10px;\n  background: var(--me-theme);\n  border-bottom: 1px solid var(--me-border);\n}\n.math-editor .me-menu-item {\n  float: left;\n  position: relative;\n  width: 50px;\n  padding: 5px;\n  text-align: center;\n  cursor: pointer;\n}\n.math-editor .me-menu-item .icon {\n  display: block;\n  height: 22px;\n  margin-bottom: 5px;\n  line-height: 28px;\n}\n.math-editor .me-menu-item.active {\n  background: var(--me-theme-light);\n}\n.math-editor .me-latex,\n.math-editor .me-svg {\n  float: left;\n  width: 50%;\n  height: calc(100% - 1px);\n  padding: 10px 12px;\n}\n.math-editor .me-latex {\n  font-size: 14px;\n  letter-spacing: 1px;\n  overflow-y: auto;\n}\n.math-editor .me-svg {\n  display: flex;\n  align-items: center;\n  background: #f6f7f8;\n  overflow-x: auto;\n}\n.math-editor .me-droplist {\n  position: absolute;\n  left: 0;\n  text-align: left;\n  background: #fff;\n  border: 1px solid var(--me-border);\n  border-radius: 3px;\n}\n.math-editor .me-droplist .me-dp-title {\n  height: 25px;\n  padding-left: 12px;\n  font-size: 12px;\n  line-height: 29px;\n  background: var(--me-theme-light);\n  border-bottom: 1px solid var(--me-border);\n}\n.math-editor .me-droplist .me-item:hover {\n  background: var(--me-hover);\n}\n.math-editor .me-droplist .me-list {\n  padding: 5px 0;\n  list-style: none;\n  line-height: 1.36;\n}\n.math-editor .me-droplist .me-list .me-item {\n  font-size: 16px;\n  padding: 5px 12px;\n}\n.math-editor .me-droplist .me-list .me-item .title {\n  margin-bottom: 8px;\n  font-size: 12px;\n  color: var(--me-gray);\n}\n.math-editor .me-droplist .me-block {\n  list-style: none;\n  padding: 5px;\n}\n.math-editor .me-droplist .me-block .me-item {\n  box-sizing: border-box;\n  display: inline-block;\n  min-width: 32px;\n  min-height: 32px;\n  margin: 5px;\n  padding: 2px;\n  line-height: 30px;\n  text-align: center;\n  border: 1px solid var(--me-border);\n  border-radius: 3px;\n}\n.math-editor .clearfix:after {\n  content: '';\n  display: block;\n  height: 0;\n  visibility: hidden;\n  clear: both;\n}\n",""]);const a=o},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,s,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);i&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),t.push(d))}},t}},81:e=>{e.exports=function(e){return e[1]}},379:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var r={},o=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],d=r[c]||0,h="".concat(c," ").concat(d);r[c]=d+1;var m=n(h),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)t[m].references++,t[m].updater(u);else{var p=s(u,i);i.byIndex=a,t.splice(a,0,{identifier:h,updater:p,references:1})}o.push(h)}return o}function s(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var r=i(e=e||[],s=s||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var a=n(r[o]);t[a].references--}for(var l=i(e,s),c=0;c<r.length;c++){var d=n(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=l}}},569:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,s&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={id:i,exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};return(()=>{n.d(i,{default:()=>I});var e=n(379),t=n.n(e),s=n(795),r=n.n(s),o=n(569),a=n.n(o),l=n(565),c=n.n(l),d=n(216),h=n.n(d),m=n(589),u=n.n(m),p=n(614),f={};function g(){}f.styleTagTransform=u(),f.setAttributes=c(),f.insert=a().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=h(),t()(p.Z,f),p.Z&&p.Z.locals&&p.Z.locals;const x='<p data-we-empty-p=""><br></p>',v=["Control","Escape","Tab","CapsLock","Shift","Meta","Alt","ArrowLeft","ArrowUp","ArrowDown","ArrowRight","Enter","Backspace","Delete","Insert"],b=[" ","{","}"];function w(e){return Array.prototype.slice.call(e)}function y(e){return`<span>${e=e.replace(/[A-Za-z0-9]+/g,(e=>`<span style="color: #ee7959">${e}</span>`))}</span>&nbsp;`}function E(e){return`<div class="me-menu-item"><span class="icon">$${e}$</span></div>`}const C=new class{_ua;isOldEdge;isFirefox;constructor(){this._ua=navigator.userAgent;const e=this._ua.match(/(Edge?)\/(\d+)/);this.isOldEdge=!!(e&&"Edge"===e[1]&&parseInt(e[2])<19),this.isFirefox=!(!/Firefox\/\d+/.test(this._ua)||/Seamonkey\/\d+/.test(this._ua))}isIE(){return"ActiveXObject"in window}isWebkit(){return/webkit/i.test(this._ua)}},S=[];function L(e){let t=[];const n=[];return t=Array.isArray(e)?e:e.split(";"),t.forEach((e=>{const t=e.split(":").map((e=>e.trim()));2===t.length&&n.push(t[0]+":"+t[1])})),n}class ${selector;length;elems;dataSource;prior;constructor(e){if(this.elems=[],this.length=this.elems.length,this.dataSource=new Map,!e)return;if(e instanceof $)return e;let t=[];const n=e instanceof Node?e.nodeType:-1;if(this.selector=e,1===n||9===n)t=[e];else if(function(e){return!!e&&(e instanceof HTMLCollection||e instanceof NodeList)}(e))t=w(e);else if(e instanceof Array)t=e;else if("string"==typeof e){const n=e.replace("/\n/mg","").trim();t=0===n.indexOf("<")?function(e){const t=document.createElement("div");return t.innerHTML=e,w(t.children)}(n):function(e){return w(document.querySelectorAll(e))}(n)}const i=t.length;if(!i)return this;let s=0;for(;s<i;s++)this.elems.push(t[s]);this.length=i}get id(){return this.elems[0].id}forEach(e){for(let t=0;t<this.length;t++){const n=this.elems[t];if(!1===e.call(n,n,t))break}return this}clone(e=!1){const t=[];return this.elems.forEach((n=>{t.push(n.cloneNode(!!e))})),R(t)}get(e=0){const t=this.length;return e>=t&&(e%=t),R(this.elems[e])}first(){return this.get(0)}last(){const e=this.length;return this.get(e-1)}on(e,t,n){return e?("function"==typeof t&&(n=t,t=""),this.forEach((i=>{if(!t)return void i.addEventListener(e,n);const s=function(e){const i=e.target;i.matches(t)&&n.call(i,e)};i.addEventListener(e,s),S.push({elem:i,selector:t,fn:n,agentFn:s})}))):this}off(e,t,n){return e?("function"==typeof t&&(n=t,t=""),this.forEach((function(i){if(t){let s=-1;for(let e=0;e<S.length;e++){const r=S[e];if(r.selector===t&&r.fn===n&&r.elem===i){s=e;break}}if(-1!==s){const{agentFn:t}=S.splice(s,1)[0];i.removeEventListener(e,t)}}else i.removeEventListener(e,n)}))):this}attr(e,t){return void 0===t?this.elems[0].getAttribute(e)||"":this.forEach((function(n){n.setAttribute(e,t)}))}removeAttr(e){this.forEach((function(t){t.removeAttribute(e)}))}addClass(e){return e?this.forEach((function(t){if(t.className){let n=t.className.split(/\s/);n=n.filter((e=>!!e.trim())),n.indexOf(e)<0&&n.push(e),t.className=n.join(" ")}else t.className=e})):this}removeClass(e){return e?this.forEach((function(t){if(!t.className)return;let n=t.className.split(/\s/);n=n.filter((t=>!(!(t=t.trim())||t===e))),t.className=n.join(" ")})):this}hasClass(e){if(!e)return!1;const t=this.elems[0];return!!t.className&&t.className.split(/\s/).includes(e)}css(e,t){let n;return n=""===t?"":`${e}:${t};`,this.forEach((t=>{const i=(t.getAttribute("style")||"").trim();if(i){let s=L(i);s=s.map((t=>0===t.indexOf(e)?n:t)),""!==n&&s.indexOf(n)<0&&s.push(n),""===n&&(s=L(s)),t.setAttribute("style",s.join("; "))}else t.setAttribute("style",n)}))}getBoundingClientRect(){return this.elems[0].getBoundingClientRect()}show(){return this.css("display","block")}hide(){return this.css("display","none")}children(){const e=this.elems[0];return e?R(e.children):null}childNodes(){const e=this.elems[0];return e?R(e.childNodes):null}replaceChildAll(e){const t=this.getNode(),n=this.elems[0];for(;n.hasChildNodes();)t.firstChild&&n.removeChild(t.firstChild);this.append(e)}append(e){return this.forEach((t=>{e.forEach((function(e){t.appendChild(e)}))}))}remove(){return this.forEach((e=>{if(e.remove)e.remove();else{const t=e.parentElement;t&&t.removeChild(e)}}))}isContain(e){const t=this.elems[0],n=e.elems[0];return t.contains(n)}getNodeName(){return this.elems[0].nodeName}getNode(e=0){return this.elems[e]}find(e){return R(this.elems[0].querySelectorAll(e))}text(e){return void 0===e?this.elems[0].innerHTML.replace(/<[^>]+>/g,(()=>"")):this.forEach((function(t){t.innerHTML=e}))}html(e){const t=this.elems[0];return void 0===e?t.innerHTML:(t.innerHTML=e,this)}val(){return this.elems[0].value.trim()}focus(){return this.forEach((e=>{e.focus()}))}prev(){return R(this.elems[0].previousElementSibling)}next(){return R(this.elems[0].nextElementSibling)}getNextSibling(){return R(this.elems[0].nextSibling)}parent(){return R(this.elems[0].parentElement)}parentUntil(e,t){const n=t||this.elems[0];if("BODY"===n.nodeName)return null;const i=n.parentElement;return i?i.matches(e)?R(i):this.parentUntil(e,i):null}equal(e){return e instanceof $?this.elems[0]===e.elems[0]:e instanceof HTMLElement&&this.elems[0]===e}insertBefore(e){const t=R(e).elems[0];return t?this.forEach((e=>{t.parentNode?.insertBefore(e,t)})):this}insertAfter(e){const t=R(e).elems[0],n=t&&t.nextSibling;return t?this.forEach((function(e){const i=t.parentNode;n?i.insertBefore(e,n):i.appendChild(e)})):this}data(e,t){if(void 0===t)return this.dataSource.get(e);this.dataSource.set(e,t)}getNodeTop(e){if(this.length<1)return this;const t=this.parent();return e.$textLatexElem.equal(this)||e.$textLatexElem.equal(t)?this:(t.prior=this,t.getNodeTop(e))}getOffsetData(){const e=this.elems[0];return{top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight,parent:e.offsetParent}}scrollTop(e){this.elems[0].scrollTo({top:e})}renderFormula(){return e=this.elems,window.MathJax&&window.MathJax.typesetPromise?(e&&!Array.isArray(e)&&(e=[e]),window.MathJax.typesetPromise(e)):Promise.reject();var e}}function R(...e){return new $(...e)}const T=R,N={width:620,height:272,menuHeight:38,mathJaxUrl:"https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/mathjax/3.2.0/es5/tex-svg.min.js"},_={menus:["presets","operators","greekLetters","inequation","calculus","arrows","Trigonometric"],presets:[{label:"勾股定理",value:"a^2+b^2=c^2"},{label:"双曲线",value:"\\frac{x^2}{a^2}-\\frac{y^2}{b^2}=1"},{label:"正弦",value:"\\sin \\alpha + \\sin \\beta =2 \\sin \\frac{\\alpha + \\beta}{2}\\cos \\frac{\\alpha - \\beta}{2}"},{label:"正切",value:"\\tan(x + y) = \\frac{\\tan x + \\tan y}{1 - \\tan x\\tan y}"},{label:"定积分",value:"\\int_a^b f(x) dx = F(b) - F(a)"},{label:"初等函数",value:"\\left( \\sin x\\right) '=\\cos x"}],operators:["+","-","\\pm","\\mp","\\times","\\div","\\ast","\\cdot","\\cap","\\cup","\\aleph","\\Re","\\top","\\bot","\\infty","\\partial","\\forall","\\exists","\\neg","\\because","\\therefore","\\varnothing","\\frac{b}{a}","\\circ","\\bullet","\\prime","\\triangle","\\angle","\\surd","\\barwedge","\\veebar","\\odot","\\oplus","\\otimes","\\oslash","\\circledcirc","\\boxdot","\\bigtriangledown","\\dagger","\\diamond","\\star","\\triangleleft","\\triangleright"],greekLetters:["\\alpha","\\beta","\\gamma","\\delta","\\epsilon","\\zeta","\\eta","\\theta","\\iota","\\kappa","\\lambda","\\mu","\\nu","\\xi","\\omicron","\\pi","\\rho","\\sigma","\\tau","\\upsilon","\\phi","\\chi","\\psi","\\omega","\\varepsilon","\\vartheta","\\varpi","\\varrho","\\varsigma","\\varphi","\\Gamma","\\Delta","\\Theta","\\Lambda","\\Xi","\\Pi","\\Sigma","\\Upsilon","\\Phi","\\Psi","\\Omega"],inequation:["\\leq","\\geq","\\prec","\\succ","\\preceq","\\succeq","\\ll","\\gg","\\equiv","\\sim","\\simeq","\\asymp","\\approx","\\ne","\\subset","\\supset","\\subseteq","\\supseteq","\\nsubseteq","\\nsupseteq","\\in","\\ni","\\notin","\\vec{a}","\\bar{a}","\\tilde{a}","\\dot{a}","\\ddot{a}","\\hat{a}","\\overleftarrow{ab}","\\overline{ab}","\\overrightarrow{ab}","\\underline{ab}","\\overbrace{ab}","\\underbrace{ab}"],calculus:["x_{a}","x^{b}","x_{a}^{b}","\\bar{x}","\\tilde{x}","\\sqrt{x}","\\sqrt[n]{x}","\\bigcap_{a}^{b}","\\bigcup_{a}^{b}","\\prod_{a}^{b}","\\coprod_{a}^{b}","\\left( x  \\right)","\\left[ x  \\right]","\\left \\{ x  \\right \\}","\\left| x  \\right|","\\int_{a}^{b}","\\oint_{a}^{b}","\\sum_{a}^{b}{x}","\\lim_{a  \\rightarrow b}{x}","\\begin{pmatrix}a&b\\\\c&d\\\\ \\end{pmatrix}","\\begin{bmatrix}a&b\\\\c&d\\\\ \\end{bmatrix}","\\begin{Bmatrix}a&b\\\\c&d\\\\ \\end{Bmatrix}","\\begin{vmatrix}a&b\\\\c&d\\\\ \\end{vmatrix}","\\frac{dy}{dx}|_{t=0}"],arrows:["\\leftarrow","\\rightarrow","\\leftrightarrow","\\Leftarrow","\\Rightarrow","\\Leftrightarrow","\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow"],trigonometric:["\\sin \\theta","\\cos \\theta","\\tan \\theta","\\csc \\theta","\\sec \\theta","\\cot \\theta"]},k=function e(t,n){const i=t.$textLatexElem,s=i.children();if(!s||!s.length)return i.append(T(x)),void e(t);const r=s.last();if(n){const n=r.html().toLowerCase(),s=r.getNodeName();if("<br>"!==n&&"<br/>"!==n||"P"!==s)return i.append(T(x)),void e(t)}t.selection.createRangeByElem(r,!1,!0),t.selection.restoreSelection()},A=class extends class{key;$elem;editor;_active;constructor(e,t){this.$elem=e,this.editor=t,this._active=!1,e.on("click",(n=>{n.stopPropagation(),t.selection.getRange()&&(e.addClass("active"),this.clickHandler())}))}clickHandler(){}active(){this._active=!0,this.$elem.addClass("me-active")}unActive(){this._active=!1,this.$elem.removeClass("me-active")}get isActive(){return this._active}}{dropList;constructor(e,t,n){super(e,t);const i=new class{menu;conf;$container;rendered;_show;hideTimeoutId;constructor(e,t){this.hideTimeoutId=0,this.menu=e,this.conf=t;const{height:n,menuHeight:i,zIndex:s=0}=this.menu.editor.config,r=T(`<p>${t.title}</p>`).addClass("me-dp-title"),o=T('<div class="me-droplist"></div>').append(r).css("z-index",s+1),a=t.list||[],l=t.type||"block",c=t.clickHandler||g,d=T(`<ul class="${"list"===l?"me-list":"me-block"}"></ul>`).css("max-height",n-i-76+"px").css("overflow-y","auto");a.forEach((e=>{const t=e.$elem,n=e.value,i=T('<li class="me-item"></li>');t&&(i.append(t),d.append(i),i.on("click",(e=>{c(n),e.stopPropagation(),this.hideTimeoutId=window.setTimeout((()=>{this.hide()}))})))})),o.append(d),o.on("mouseleave",(()=>{this.hideTimeoutId=window.setTimeout((()=>{this.hide()}))})),this.$container=o,this.rendered=!1,this._show=!1}show(){this.hideTimeoutId&&clearTimeout(this.hideTimeoutId);const e=this.menu.$elem,t=this.$container;if(!this._show){if(this.rendered)t.show();else{const{menuHeight:n}=this.menu.editor.config,i=this.conf.width||232;t.css("top",n-1+"px").css("width",i+"px"),e.append(t),this.rendered=!0,e.renderFormula()}this._show=!0}}hide(){const e=this.$container;this._show&&(e.hide(),this._show=!1)}get isShow(){return this._show}}(this,n);this.dropList=i,e.on("mouseover",(()=>{t.selection.getRange()&&(e.addClass("active"),i.show())})).on("mouseleave",(()=>{e.removeClass("active"),i.hideTimeoutId=window.setTimeout((()=>{i.hide()}))}))}command(e){const t=this.editor,n=t.selection.isSelectionEmpty(),i=t.selection.getSelectionContainerElem()?.elems[0];if(!i)return;const s=y(e);t.cmd.do(s),n&&(t.selection.collapseRange(),t.selection.restoreSelection())}},H=class{itemList;constructor(e){this.itemList=e.map((({label:e,value:t})=>({$elem:T(`<p class="title">${e}：</p><p>$ ${t} $</p>`),value:t})))}getItemList(){return this.itemList}},M=class{itemList;constructor(e){this.itemList=e.map((e=>({$elem:T(`<span>$${e}$</span>`),value:e})))}getItemList(){return this.itemList}},q={presets:class extends A{constructor(e){super(T(E("f_{(x)}")),e,{width:252,title:"插入预设公式",type:"list",list:new H(e.menusConfig.presets).getItemList(),clickHandler:e=>{this.command(e)}})}},operators:class extends A{constructor(e){super(T(E("O")),e,{title:"插入运算符",list:new M(e.menusConfig.operators).getItemList(),clickHandler:e=>{this.command(e)}})}},greekLetters:class extends A{constructor(e){super(T(E("\\Omega")),e,{title:"插入希腊字母",list:new M(e.menusConfig.greekLetters).getItemList(),clickHandler:e=>{this.command(e)}})}},inequation:class extends A{constructor(e){super(T(E("\\ne")),e,{title:"插入不等式",list:new M(e.menusConfig.inequation).getItemList(),clickHandler:e=>{this.command(e)}})}},calculus:class extends A{constructor(e){super(T(E("\\Sigma")),e,{width:244,title:"插入微积分",list:new M(e.menusConfig.calculus).getItemList(),clickHandler:e=>{this.command(e)}})}},arrows:class extends A{constructor(e){super(T(E("\\rightarrow")),e,{title:"插入箭头符号",list:new M(e.menusConfig.arrows).getItemList(),clickHandler:e=>{this.command(e)}})}},Trigonometric:class extends A{constructor(e){super(T(E("\\sin \\theta")),e,{title:"插入三角函数",list:new M(e.menusConfig.trigonometric).getItemList(),clickHandler:e=>{this.command(e)}})}}};try{document}catch(e){throw new Error("请在浏览器环境下运行")}const I=class{config;menusConfig;$editorRootElem;$toolbarElem;$textLatexElem;$textSvgElem;cmd;selection;menus;latex;constructor(){this.config=N,this.menusConfig=_,this.$editorRootElem=T('<div class="math-editor"></div>'),this.$toolbarElem=T('<div class="me-menu"></div>'),this.$textLatexElem=T('<div class="me-latex"></div>'),this.$textSvgElem=T('<div class="me-svg"></div>'),this.cmd=new class{editor;constructor(e){this.editor=e}do(e){const t=this.editor.selection;t.getRange()&&(t.restoreSelection(),this.insertHtml(e),this.renderFormula(),t.saveRange(),t.restoreSelection())}insert(e,t){if(t){const t=this.editor.selection.getRange();if(t){const e=t.startContainer;t.setStart(e,t.endOffset),t.setEnd(e,t.endOffset),t.deleteContents()}return void this.insertHtml(" "===e?"&nbsp;":e)}const n=`<span style="color: #ee7959">${" "!==(i=e)?i:"&nbsp;"}</span>`;var i;this.do(n)}renderFormula(){const e=this.editor;let t=e.latex.text();const n=e.$textSvgElem;if(!t.replace(/(&nbsp;)|( )/g,""))return void n.html("<p></p>");if(t=t.replace(/&nbsp;/g," ").trim(),n.attr("data-latex")===t)return;const i=`$ ${t} $`;n.attr("data-latex",t),n.html(i),n.renderFormula()}insertHtml(e){const t=this.editor,n=t.selection.getRange();if(n)if(this.queryCommandSupported("insertHTML"))this.execCommand("insertHTML",e);else if(n.insertNode){if(n.deleteContents(),T(e).elems.length>0)n.insertNode(T(e).elems[0]);else{const t=document.createElement("p");t.appendChild(document.createTextNode(e)),n.insertNode(t)}t.selection.collapseRange()}}execCommand(e,t){document.execCommand(e,!1,t)}queryCommandSupported(e){return document.queryCommandSupported(e)}}(this),this.selection=new class{editor;_currentRange=null;constructor(e){this.editor=e}getRange(){return this._currentRange}saveRange(e){if(e)return void(this._currentRange=e);const t=window.getSelection();if(0===t.rangeCount)return;const n=t.getRangeAt(0),i=this.getSelectionContainerElem(n);if(!i?.length)return;const s=this.editor,r=s.$textLatexElem;if(r.isContain(i)){if(r.elems[0]===i.elems[0]&&r.html().trim()===x){const e=r.children()?.last();s.selection.createRangeByElem(e,!0,!0),s.selection.restoreSelection()}this._currentRange=n}}collapseRange(e=!1){const t=this._currentRange;t&&t.collapse(e)}getSelectionText(){const e=this._currentRange;return e?e.toString():""}getSelectionContainerElem(e){const t=e||this._currentRange;if(t){const e=t.commonAncestorContainer;return T(1===e.nodeType?e:e.parentNode)}}getSelectionStartElem(e){const t=e||this._currentRange;if(t){const e=t.startContainer;return T(1===e.nodeType?e:e.parentNode)}}getSelectionEndElem(e){const t=e||this._currentRange;if(t){const e=t.endContainer;return T(1===e.nodeType?e:e.parentNode)}}isSelectionEmpty(){const e=this._currentRange;return!(!e||!e.startContainer||e.startContainer!==e.endContainer||e.startOffset!==e.endOffset)}restoreSelection(){const e=window.getSelection(),t=this._currentRange;e&&t&&(e.removeAllRanges(),e.addRange(t))}createRangeByElems(e,t){(window.getSelection?window.getSelection():document.getSelection())?.removeAllRanges();const n=document.createRange();n.setStart(e,0),n.setEnd(t,t.childNodes.length||1),this.saveRange(n),this.restoreSelection()}createRangeByElem(e,t,n){if(!e.length)return;const i=e.elems[0],s=document.createRange();n?s.selectNodeContents(i):s.selectNode(i),null!=t&&(s.collapse(t),t||(this.saveRange(s),this.editor.selection.moveCursor(i))),this.saveRange(s)}getSelectionRangeTopNodes(){const e=this.getSelectionStartElem()?.getNodeTop(this.editor),t=this.getSelectionEndElem()?.getNodeTop(this.editor);return this.recordSelectionNodes(T(e),T(t))}moveCursor(e,t){const n=this.getRange();let i=3===e.nodeType?e.nodeValue?.length:e.childNodes.length;(C.isFirefox||C.isIE())&&0!==i&&(3!==e.nodeType&&"BR"!==e.childNodes[i-1].nodeName||(i-=1));const s=t??i;n&&e&&(n.setStart(e,s),n.setEnd(e,s),this.restoreSelection())}getCursorPos(){return window.getSelection()?.anchorOffset}clearWindowSelectionRange(){const e=window.getSelection();e&&e.removeAllRanges()}recordSelectionNodes(e,t){const n=[];let i=!0;try{let s=e;const r=this.editor.$textLatexElem;for(;i;){const e=s?.getNodeTop(this.editor);"BODY"===e.getNodeName()&&(i=!1),e.length>0&&(n.push(T(s)),t?.equal(e)||r.equal(e)?i=!1:s=e.getNextSibling())}}catch(e){i=!1}return n}setRangeToElem(e){const t=this.getRange();t?.setStart(e,0),t?.setEnd(e,0)}}(this),this.menus=new class{editor;menuList;constructorList;constructor(e){this.editor=e,this.menuList=[],this.constructorList=q}extend(e,t){t&&"function"==typeof t&&(this.constructorList[e]=t)}init(){this.editor.menusConfig.menus.forEach((e=>{const t=this.constructorList[e];this._initMenuList(e,t)})),this._addToToolbar()}_initMenuList(e,t){if("function"==typeof t)if(this.menuList.some((t=>t.key===e)))console.warn("菜单名称重复:"+e);else{const n=new t(this.editor);n.key=e,this.menuList.push(n)}}_addToToolbar(){const e=this.editor.$toolbarElem;e.addClass("clearfix"),this.menuList.forEach((t=>{const n=t.$elem;n&&e.append(n)}))}menuFind(e){const t=this.menuList;for(let n=0,i=t.length;n<i;n++)if(t[n].key===e)return t[n];return t[0]}}(this),this.latex=new class{editor;constructor(e){this.editor=e}init(){this._saveRange()}clear(){this.editor.$textLatexElem.replaceChildAll(T(x))}text(){return this.editor.$textLatexElem.text().replace(/&nbsp;/g," ")}_saveRange(){const e=this.editor,t=e.$textLatexElem,n=T(document);function i(){e.selection.saveRange()}function s(){i(),n.off("mouseup",s)}function r(){n.on("mouseup",s),t.off("mouseleave",r)}t.on("keyup",function(e,t=200){let n=0;return function(...i){n&&window.clearTimeout(n),n=window.setTimeout((()=>{n=0,e.call(this,...i)}),t)}}((function(){i(),e.cmd.renderFormula()}))),t.on("keydown",(function(t){const n=t.key,s=t.ctrlKey&&!v.includes(n),r=b.includes(n);(s||r)&&(t.preventDefault(),i(),e.cmd.insert(n,r))})),t.on("click",(function e(){i(),t.off("click",e)})),t.on("mousedown",(()=>{t.on("mouseleave",r)})),t.on("mouseup",(()=>{t.off("mouseleave",r),setTimeout((()=>{e.selection.getRange()&&i()}),0)}))}}(this)}static $=T;create(e,t){!function(e){if(window.MathJax)return;const t=document.createElement("script");t.src=e,t.async=!0,document.head.appendChild(t)}(this.config.mathJaxUrl),this.menus.init(),this.latex.init(),function(e){const{$editorRootElem:t,$toolbarElem:n,$textLatexElem:i,$textSvgElem:s,config:r}=e;t.append(n);const o=T("<div></div>");o.addClass("clearfix").css("width","100%").css("height",r.height-r.menuHeight+"px").css("overflow","hidden"),i.attr("contenteditable","true").css("outline","none").css("border-right","1px solid #ccc"),o.append(i).append(s),t.css("width",r.width+"px").css("height",r.height+"px"),t.append(o)}(this);const n=T(e);n.text("资源加载中..."),function(e){window.MathJax?e&&e():window.MathJax={tex:{inlineMath:[["$","$"]],processEnvironments:!0,processRefs:!0},options:{skipHtmlTags:["noscript","style","textarea","pre","code"],ignoreHtmlClass:"tex2jax_ignore"},startup:{pageReady:()=>e&&e()},svg:{fontCache:"global"}}}((()=>{n.text("").append(this.$editorRootElem),this.initSelection(),this.$toolbarElem.renderFormula(),t&&t()}))}append(e){const t=y(e);this.cmd.do(t)}initSelection(){k(this)}destoryDom(){this.$editorRootElem.remove()}}})(),i.default})()));